<!DOCTYPE html>
<html>
<head>
<title>Shipment Dashboard</title>
<style>
body{font-family:Arial;background:#f4f4f4;}
.container{width:80%;margin:auto;background:#fff;padding:20px;border-radius:8px;}
input{width:100%;padding:8px;margin:5px 0;}
button{background:#28a745;color:#fff;border:none;padding:8px 12px;margin-top:5px;cursor:pointer;}
table{width:100%;border-collapse:collapse;margin-top:15px;}
td,th{border:1px solid #28a745;padding:8px;}
th{background:#28a745;color:#fff;}
</style>
</head>

<body>

<div class="container">

<h2>Search / Edit Shipment</h2>
<input id="searchAwb" placeholder="Enter AWB">
<button onclick="loadAWB()">Load</button>

<hr>

<h2>Manage Shipment</h2>

<input id="awb" placeholder="AWB">
<input id="date" placeholder="Booking Date">
<input id="consignee" placeholder="Consignee">
<input id="destination" placeholder="Destination">
<input id="status" placeholder="Status">
<input id="deliveryDate" placeholder="Delivery Date">
<input id="receiver" placeholder="Receiver">
<input id="deliveryAwb" placeholder="Delivery AWB">

<button onclick="updateAWB()">Save / Update Shipment</button>

<hr>

<h3>Add Progress</h3>
<input type="date" id="p_date">
<input type="time" id="p_time">
<input id="p_location" placeholder="Location">
<input id="p_activity" placeholder="Activity">
<button onclick="addProgress()">Add Progress</button>

<table id="progressTable">
<tr>
<th>Date</th>
<th>Time</th>
<th>Location</th>
<th>Activity</th>
<th>Delete</th>
</tr>
</table>

</div>

<script>

function getDB(){
  return JSON.parse(localStorage.getItem("shipments")) || {};
}
function saveDB(db){
  localStorage.setItem("shipments", JSON.stringify(db));
}

function loadAWB(){
 const id = searchAwb.value.trim();
 let db = getDB();
 const s = db[id];
 if(!s){ alert("AWB not found"); return; }

 awb.value=s.awb;
 date.value=s.bookingDate;
 consignee.value=s.consignee;
 destination.value=s.destination;
 status.value=s.status;
 deliveryDate.value=s.deliveryDate;
 receiver.value=s.receiver;
 deliveryAwb.value=s.deliveryAwb;

 showProgress(id);
}

function updateAWB(){
 const id = awb.value.trim();
 if(!id){ alert("Enter AWB"); return; }

 let db = getDB();
 if(!db[id]) db[id] = { progress: [] };

 db[id].awb = id;
 db[id].bookingDate = date.value;
 db[id].consignee = consignee.value;
 db[id].destination = destination.value;
 db[id].status = document.getElementById("status").value.trim() || db[id].status;
 db[id].deliveryDate = deliveryDate.value;
 db[id].receiver = receiver.value;
 db[id].deliveryAwb = deliveryAwb.value;

 saveDB(db);
 alert("Shipment Saved / Updated");

 showProgress(id);
}

function addProgress(){
 const id = awb.value.trim();
 let db = getDB();
 if(!db[id]){ alert("Save AWB first"); return; }

 db[id].progress.unshift({
  date: p_date.value,
  time: p_time.value,
  location: p_location.value,
  activity: p_activity.value
 });

 saveDB(db);
 alert("Progress Added");

 showProgress(id);
}

function showProgress(id){
 let db = getDB();
 let table = progressTable;

 table.innerHTML = `<tr>
 <th>Date</th><th>Time</th><th>Location</th><th>Activity</th><th>Delete</th>
 </tr>`;

 db[id].progress.forEach((p,i)=>{
  let r = table.insertRow(-1);
  r.insertCell(0).innerText = p.date;
  r.insertCell(1).innerText = p.time;
  r.insertCell(2).innerText = p.location;
  r.insertCell(3).innerText = p.activity;
  r.insertCell(4).innerHTML = `<button onclick="deleteProgress('${id}',${i})">Delete</button>`;
 });
}

function deleteProgress(id,i){
 let db = getDB();
 db[id].progress.splice(i,1);
 saveDB(db);
 showProgress(id);
}

</script>

</body>
</html>
