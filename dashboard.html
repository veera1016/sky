<!DOCTYPE html>
<html>
<head>
<title>Shipment Dashboard</title>

<style>
body{font-family:Arial;background:#f4f4f4;}
.container{width:80%;margin:auto;background:#fff;padding:20px;border-radius:8px;}
input{width:100%;padding:8px;margin:5px 0;}
button{background:#28a745;color:#fff;border:none;padding:8px 12px;margin-top:5px;cursor:pointer;}
table{width:100%;border-collapse:collapse;margin-top:15px;}
td,th{border:1px solid #28a745;padding:8px;}
th{background:#28a745;color:#fff;}
</style>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<script>
const firebaseConfig = YOUR_FIREBASE_CONFIG_HERE;
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
</script>

</head>

<body>

<div class="container">

<h2>Search / Edit Shipment</h2>
<input id="searchAwb" placeholder="Enter AWB">
<button onclick="loadAWB()">Load</button>

<hr>

<h2>Manage Shipment</h2>

<input id="awb" placeholder="AWB">
<input id="date" placeholder="Booking Date">
<input id="consignee" placeholder="Consignee">
<input id="destination" placeholder="Destination">
<input id="status" placeholder="Status">
<input id="deliveryDate" placeholder="Delivery Date">
<input id="receiver" placeholder="Receiver">
<input id="deliveryAwb" placeholder="Delivery AWB">

<button onclick="updateAWB()">Save / Update Shipment</button>

<hr>

<h3>Add Progress</h3>
<input type="date" id="p_date">
<input type="time" id="p_time">
<input id="p_location" placeholder="Location">
<input id="p_activity" placeholder="Activity">
<button onclick="addProgress()">Add Progress</button>

<table id="progressTable">
<tr>
<th>Date</th>
<th>Time</th>
<th>Location</th>
<th>Activity</th>
<th>Delete</th>
</tr>
</table>

</div>

<script>

/* LOAD SHIPMENT FROM FIREBASE */
function loadAWB(){

 const id = document.getElementById("searchAwb").value.trim();
 if(!id){ alert("Enter AWB"); return; }

 db.ref("shipments/" + id).once("value").then(snapshot => {

   const s = snapshot.val();
   if(!s){ alert("AWB not found"); return; }

   awb.value = s.awb || "";
   date.value = s.bookingDate || "";
   consignee.value = s.consignee || "";
   destination.value = s.destination || "";
   status.value = s.status || "";
   deliveryDate.value = s.deliveryDate || "";
   receiver.value = s.receiver || "";
   deliveryAwb.value = s.deliveryAwb || "";

   showProgress(id);

 });

}

/* SAVE SHIPMENT */
function updateAWB(){

 const id = document.getElementById("awb").value.trim();
 if(!id){ alert("Enter AWB"); return; }

 db.ref("shipments/" + id).set({
  awb: id,
  bookingDate: date.value,
  consignee: consignee.value,
  destination: destination.value,
  status: status.value,
  deliveryDate: deliveryDate.value,
  receiver: receiver.value,
  deliveryAwb: deliveryAwb.value
 });

 alert("Shipment Saved to Firebase");

}

/* ADD PROGRESS */
function addProgress(){

 const id = document.getElementById("awb").value.trim();
 if(!id){ alert("Enter AWB first"); return; }

 const progressId = Date.now();

 db.ref("shipments/" + id + "/progress/" + progressId).set({
  date: p_date.value,
  time: p_time.value,
  location: p_location.value,
  activity: p_activity.value
 });

 alert("Progress Added");
 showProgress(id);

}

/* SHOW PROGRESS */
function showProgress(id){

 let table = document.getElementById("progressTable");

 table.innerHTML = `<tr>
 <th>Date</th><th>Time</th><th>Location</th><th>Activity</th><th>Delete</th>
 </tr>`;

 db.ref("shipments/" + id + "/progress").once("value").then(snapshot => {

   const data = snapshot.val();
   if(!data) return;

   Object.keys(data).reverse().forEach(key => {
     const p = data[key];
     let r = table.insertRow(-1);
     r.insertCell(0).innerText = p.date;
     r.insertCell(1).innerText = p.time;
     r.insertCell(2).innerText = p.location;
     r.insertCell(3).innerText = p.activity;
     r.insertCell(4).innerHTML =
       `<button onclick="deleteProgress('${id}','${key}')">Delete</button>`;
   });

 });

}

/* DELETE PROGRESS */
function deleteProgress(id,key){
 db.ref("shipments/" + id + "/progress/" + key).remove();
 showProgress(id);
}

</script>

</body>
</html>
